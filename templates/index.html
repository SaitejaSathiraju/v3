<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Recognition Photo Search</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.6s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-purple-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-sm border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                        </svg>
                    </div>
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                        Face Recognition Search
                    </h1>
                </div>
                <div class="text-sm text-gray-500">
                    Powered by AI
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Welcome Section -->
        <div class="text-center mb-12 animate-fade-in">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">
                Welcome to Face Recognition Search
            </h2>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                This application searches through your photo collection to find faces that match the uploaded image. 
                Upload a photo to get started!
            </p>
        </div>

        <!-- Upload Section -->
        <div class="max-w-md mx-auto mb-12 animate-slide-up">
            <form method="POST" enctype="multipart/form-data" class="space-y-4" id="searchForm">
                <div class="relative">
                    <input type="file" name="file" accept="image/*" required 
                           class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" 
                           id="fileInput" />
                    <div class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-blue-400 transition-colors duration-200 bg-white/50 backdrop-blur-sm">
                        <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <div class="text-sm text-gray-600">
                            <label for="fileInput" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500">
                                <span>Upload a photo</span>
                            </label>
                            <p class="pl-1">or drag and drop</p>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">PNG, JPG, JPEG up to 10MB</p>
                    </div>
                </div>
                
                <!-- Image Preview Section -->
                <div id="imagePreview" class="hidden">
                    <div class="bg-white rounded-xl p-4 shadow-md border border-gray-200">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">Selected Image:</h3>
                        <div class="relative">
                            <img id="previewImg" src="" alt="Preview" class="w-full h-48 object-cover rounded-lg" />
                            <div class="absolute top-2 right-2">
                                <button type="button" id="removeImage" class="bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600 transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <p id="fileName" class="text-sm text-gray-600 mt-2 text-center"></p>
                    </div>
                </div>
                
                <button type="submit" 
                        class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold py-3 px-6 rounded-xl hover:from-blue-600 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed"
                        id="searchButton">
                    <span id="buttonText">üîç Search for Matches</span>
                    <span id="loadingSpinner" class="hidden">
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Processing...
                    </span>
                </button>
                
                <!-- Loading Progress Bar -->
                <div id="loadingProgress" class="hidden">
                    <div class="bg-gray-200 rounded-full h-2 mb-2">
                        <div id="progressBar" class="bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <p id="progressText" class="text-sm text-gray-600 text-center">Initializing face recognition...</p>
                </div>
            </form>
        </div>

        <!-- Results Section -->
        {% if strong_images or doubtful_images %}
        <div class="space-y-8 animate-fade-in">
            <!-- Strong Matches -->
            {% if strong_images %}
            <div class="bg-white/70 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-gray-200">
                <div class="flex items-center space-x-3 mb-6">
                    <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Strong Matches</h2>
                    <span class="bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full">
                        {{ strong_images|length }} found
                    </span>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    {% for img in strong_images %}
                    <div class="group bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 transform hover:scale-105 overflow-hidden">
                        <div class="w-full h-64 bg-gray-100">
                            <img src="{{ url_for('static', filename=img.path) }}" 
                                 alt="{{ img.original_name }}" 
                                 class="w-full h-full object-contain p-2" />
                        </div>
                        <div class="p-4 text-center">
                            <p class="text-gray-800 font-medium break-words text-sm">{{ img.original_name }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Doubtful Matches -->
            {% if doubtful_images %}
            <div class="bg-white/70 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-gray-200">
                <div class="flex items-center space-x-3 mb-6">
                    <div class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center">
                        <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Possible Matches</h2>
                    <span class="bg-yellow-100 text-yellow-800 text-sm font-medium px-3 py-1 rounded-full">
                        {{ doubtful_images|length }} found
                    </span>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    {% for img in doubtful_images %}
                    <div class="group bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 transform hover:scale-105 overflow-hidden">
                        <div class="w-full h-64 bg-gray-100">
                            <img src="{{ url_for('static', filename=img.path) }}" 
                                 alt="{{ img.original_name }}" 
                                 class="w-full h-full object-contain p-2" />
                        </div>
                        <div class="p-4 text-center">
                            <p class="text-gray-800 font-medium break-words text-sm">{{ img.original_name }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- No Results Message -->
        {% if request.method == 'POST' and not strong_images and not doubtful_images %}
        <div class="text-center py-12 animate-fade-in">
            <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.29-1.009-5.824-2.562M15 9.75a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-800 mb-2">No Matches Found</h3>
            <p class="text-gray-600">Try uploading a different photo or check if the face is clearly visible.</p>
        </div>
        {% endif %}
    </main>

    <!-- Footer -->
    <footer class="bg-white/80 backdrop-blur-sm border-t border-gray-200 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="text-center text-sm text-gray-500">
                <p>&copy; 2024 Face Recognition Search. Built with Flask and AI.</p>
            </div>
        </div>
    </footer>

    <!-- File Input Enhancement Script -->
    <script>
        const fileInput = document.getElementById('fileInput');
        const uploadArea = fileInput.nextElementSibling;
        const imagePreview = document.getElementById('imagePreview');
        const previewImg = document.getElementById('previewImg');
        const fileName = document.getElementById('fileName');
        const removeImage = document.getElementById('removeImage');
        const searchForm = document.getElementById('searchForm');
        const searchButton = document.getElementById('searchButton');
        const buttonText = document.getElementById('buttonText');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const loadingProgress = document.getElementById('loadingProgress');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        
        // Show image preview when file is selected
        function showImagePreview(file) {
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    fileName.textContent = file.name;
                    imagePreview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Hide image preview
        function hideImagePreview() {
            imagePreview.classList.add('hidden');
            previewImg.src = '';
            fileName.textContent = '';
            fileInput.value = '';
        }
        
        // Show loading state
        function showLoading() {
            buttonText.classList.add('hidden');
            loadingSpinner.classList.remove('hidden');
            loadingProgress.classList.remove('hidden');
            searchButton.disabled = true;
            
            // Simulate progress updates
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 90) progress = 90;
                
                progressBar.style.width = progress + '%';
                
                if (progress < 30) {
                    progressText.textContent = 'Loading uploaded image...';
                } else if (progress < 60) {
                    progressText.textContent = 'Processing face detection...';
                } else if (progress < 90) {
                    progressText.textContent = 'Searching through photo collection...';
                }
            }, 200);
            
            // Store interval for cleanup
            window.progressInterval = progressInterval;
        }
        
        // Hide loading state
        function hideLoading() {
            buttonText.classList.remove('hidden');
            loadingSpinner.classList.add('hidden');
            loadingProgress.classList.add('hidden');
            searchButton.disabled = false;
            
            // Complete progress bar
            progressBar.style.width = '100%';
            progressText.textContent = 'Search completed!';
            
            // Clear progress interval
            if (window.progressInterval) {
                clearInterval(window.progressInterval);
            }
            
            // Reset progress after delay
            setTimeout(() => {
                progressBar.style.width = '0%';
                progressText.textContent = 'Initializing face recognition...';
            }, 2000);
        }
        
        // File input change event
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                showImagePreview(e.target.files[0]);
            }
        });
        
        // Remove image button
        removeImage.addEventListener('click', hideImagePreview);
        
        // Form submit event
        searchForm.addEventListener('submit', function() {
            if (fileInput.files.length > 0) {
                showLoading();
            }
        });
        
        // Drag and drop functionality
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('border-blue-400', 'bg-blue-50');
        });
        
        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('border-blue-400', 'bg-blue-50');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('border-blue-400', 'bg-blue-50');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                showImagePreview(files[0]);
            }
        });
    </script>
</body>
</html>